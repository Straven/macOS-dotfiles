#should be always on top
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
sudo yabai --load-sa

# Global settings
yabai -m config layout stack

# Window settings
yabai -m config window_opacity on
opacity_value = 0.75
#yabai -m config active_window_opacity $opacity_value
#yabai -m config normal_window_opacity $opacity_value

# Window modifications
yabai -m config window_shadow float
yabai -m config window_border off

# Mouse settings
yabai -m config mouse_follows_focus off
yabai -m config focus_follows_mouse off

# Stack settings
yabai -m config window_topmost off
#yabai -m config window_opacity_duration 0.0

# Padding and gaps (minimal for stack mode)
yabai -m config top_padding 8
yabai -m config bottom_padding 8
yabai -m config left_padding 8
yabai -m config right_padding 8
yabai -m config window_gap 8

# ============================================
# SKETCHYBAR INTEGRATION
# ============================================

# Reserve space for SketchyBar (40px bar + 8px padding = 48px)
yabai -m config external_bar all:48:0

# ============================================
# LOAD APP VARIABLES
# ============================================

# Source the app configuration file
# source "$HOME/.config/yabai/apps.sh"

# ============================================
# APP-SPECIFIC RULES
# ============================================

# Apply opacity rules for non-transparent apps
#for app in "${NON_TRANSPARENT_APPS[@]}"; do
#    yabai -m rule --add event=window_focused app="^${non_transparent_apps}$" action="yabai -m config active_window_opacity 1"
#done

# Apply opacity rules for transparent apps
#for app in "${TRANSPARENT_APPS[@]}"; do
#    yabai -m rule --add event=window_focused app="^${transparent_apps}$" action="yabai -m config active_window_opacity $opacity_value"
#done

# Define non-transparent apps (opacity = 1.0)
# Only apps listed here will be fully opaque
non_transparent_apps="(Safari|Zen Browser|WhatsApp|Google Chrome|Microsoft Word|Microsoft Excel)"

# Define transparent apps - optional, just for documentation
# These will use the default opacity of 0.75
transparent_apps="(Ghostty|Spotify|Music|Notes|Claude|Monica|Obsidian|Finder|Zed)"
yabai -m signal --add event=window_focused app="^${transparent_apps}$" action="yabai -m config active_window_opacity $opacity_value"
yabai -m signal --add event=window_focused app="^${transparent_apps}$" action="yabai -m config normal_window_opacity 0.00001"

# Apply non-transparency rules (explicitly set to 1.0)
#yabai -m rule --add app="${non_transparent_apps}" opacity=1.0
yabai -m signal --add event=window_focused app="^${non_transparent_apps}$" action="yabai -m config active_window_opacity 1"
yabai -m signal --add event=window_focused app="^${non_transparent_apps}$" action="yabai -m config normal_window_opacity 1" 

# Note: Apps in transparent_apps will automatically use the default opacity (0.75)
# No need to explicitly set rules for transparent apps

system_apps="(System Settings|System Preferences|System Information|Activity Monitor|Calculator|App Store|Archive Utility)"

# ============================================
# SYSTEM APPS TO IGNORE
# ============================================

#for app in "${SYSTEM_APPS[@]}"; do
    yabai -m rule --add app="^${system_apps}$" manage=off
#done

# Floating windows
yabai -m rule --add title="^(Opening|Preferences|Settings)" manage=off
yabai -m rule --add title="^Software Update$" manage=off

# ============================================
# SPACE ASSIGNMENTS
# ============================================

# Space 2: Safari (S)
yabai -m rule --add app="^Safari$" space=2

# Space 3: Ghostty (T - Terminal)
yabai -m rule --add app="^Ghostty$" space=3

# Space 4: Obsidian (O)
yabai -m rule --add app="^Obsidian$" space=4
yabai -m rule --add app"^Zed$" space=4

# Space 5: Work/Communication (W)
yabai -m rule --add app="^Google Chrome$" space=5
yabai -m rule --add app="^Microsoft Excel$" space=5
yabai -m rule --add app="^Microsoft Word" space=5
yabai -m rule --add app="^Notes$" space=5

# Space 6: AI Assistants (AI)
yabai -m rule --add app="^Claude$" space=6
yabai -m rule --add app="^Monica$" space=6

# Space 7: Media (M)
yabai -m rule --add app="^Spotify$" space=7
yabai -m rule --add app="^Music$" space=7
yabai -m rule --add app="^TV$" space=7
yabai -m rule --add app="^Megogo$" space=7

# Space 8: Communication (C)
yabai -m rule --add app="^WhatsApp$" space=8
yabai -m rule --add app="^Telegram$" space=8
yabai -m rule --add app="^Discord$" space=8

# ============================================
# DYNAMIC LAYERING
# ============================================
yabai -m rule --add app=".*" layer=normal
# Add signal to call helper script on window focus
# yabai -m signal --add event=window_focused action="~/.config/yabai/layer_manager.sh"

yabai -m signal --add event=window_focused action="sketchybar --trigger window_focus"

###############################################################################
#                                Defaults
###############################################################################

yabai -m config \
	focus_follows_mouse off \
	window_origin_display default \
	window_placement second_child \
	window_zoom_persist on \
	window_shadow off \
	window_animation_duration 2 \
	window_animation_frame_rate 120 \
	window_opacity_duration 0.0 \
	insert_feedback_color 0xffd75f5f \
	active_window_border_color 0xff775759 \
	normal_window_border_color 0xff555555 \
	window_border_width 4 \
	window_border_radius 12 \
	window_border_blur off \
	window_border_hidpi on \
	window_border off \
	split_ratio 0.50 \
	split_type auto \
	auto_balance off \
	window_gap 06 \
	layout stack \
	mouse_modifier fn \
	mouse_action1 move \
	mouse_action2 resize \
	mouse_drop_action swap

echo "yabai configuration loaded.."
