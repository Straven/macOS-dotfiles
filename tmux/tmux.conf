set -g default-shell /opt/homebrew/bin/fish

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

set -g mouse on

set -g base-index 1
setw -g pane-base-index 1

set -g renumber-windows on

set -g history-limit 1000000

set -g status-interval 3
set -g focus-events on

setw -g aggressive-resize on

set -g escape-time 10

set -g detach-on-destroy off

set -g set-clipboard on

set -gq allow-passthrough on

set -ga update-environment $TERM
set -ga update-environment $TERM_PROGRAM

#set -g status-left "#[fg=blue,bold]#S" #session name
#set -g status-left-length 60
#set -g status off
set -g status-position top
#set -g status-right ""
#set -g status-right-length 200
#set -g status-right-length 500
#set -g status-right '#{nowplaying} | %H:%M'
#set -g status-style 'bg=default'

unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "✓ Config reloaded!"

# Split panes (maintain current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window (maintain current path)
bind c new-window -c "#{pane_current_path}"

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick homescreen access
bind C-h switch-client -t homescreen

# Kill pane/session with confirmation
bind q confirm-before -p "Kill pane #P? (y/n)" kill-pane
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ============================================
# Copy Mode (Vim bindings)
# ============================================

setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Don't exit copy mode on mouse selection
unbind -T copy-mode-vi MouseDragEnd1Pane

bind-key x kill-pane

bind-key "K" display-popup -E -w 40% "sesh connect \"$(
  sesh list -i | gum filter --limit 1 --placeholder 'Pick a sesh' --prompt='⚡'
)\""

bind-key "J" run-shell "sesh connect \"$(
  sesh list -i | fzf-tmux -p 55%,60% \
    --no-sort --border-label ' sesh ' --prompt '⚡  ' \
    --header '  ^a all ^t tmux ^x zoxide ^g config ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(⚡  )+reload(sesh list -i)' \
    --bind 'ctrl-t:change-prompt(🪟  )+reload(sesh list -it)' \
    --bind 'ctrl-g:change-prompt(⚙️  )+reload(sesh list -ic)' \
    --bind 'ctrl-x:change-prompt(📁  )+reload(sesh list -iz)' \
    --bind 'ctrl-f:change-prompt(🔎  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {})+change-prompt(⚡  )+reload(sesh list)'
)\""

set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'joshmedeski/tmux-fzf-url'

set -g @plugin 'dracula/tmux'
set -g @dracula-show-left-icon "🐈‍⬛ | #S | #W 🐈‍⬛"
set -g @dracula-left-icon-padding 1
set -g @dracula-left-pad ' ° '
set -g @dracula-right-pad ' ° '
#set -g @dracula-show-left-sep 
set -g @dracula-plugins "uptime time battery mac-player mpc playerctl spotify-tui spr"
set -g @dracula-show-flags false
set -g @dracula-refresh-rate 3
set -g @dracula-border-contrast false
set -g @dracula-show-empty-plugins false
set -g @dracula-show-edge-icons false
set -g @dracula-battery-label "♥  "
set -g @dracula-show-battery-status true
set -g @dracula-mac-player-play-icon "♪ "
set -g @dracula-mac-player-pause-icon "❚❚ "
set -g @dracula-mac-player-length 250
set -g @dracula-mac-player-remote true
set -g @dracula-mac-player-remote-play-pause "P"
set -g @dracula-mac-player-remote-back "R"
set -g @dracula-mac-player-remote-next "N"
set -g @dracula-show-timezone false
set -g @dracula-time-format "%R"
#set -g @dracula-playerctl-format "►  {{ artist }} - {{ title }}"
#set -g @dracula-spotify-tui-format "%f %s %t - %a"
#set -g @dracula-spotify-tui-max-len 0
#set -g @dracula-spr-play-icon "♪ "
#set -g @dracula-spr-pause-icon "❚❚ "
#set -g @dracula-spr-remote true
#set -g @dracula-spr-remote-play-pause "P"
#set -g @dracula-spr-remote-back "R"
#set -g @dracula-spr-remote-next "N"

set -g @plugin 'jaclu/tmux-power-zoom'

set -g @plugin 'christoomey/vim-tmux-navigator' # Enable navigating between nvim and tmux

set -g @plugin 'tmux-plugins/tmux-resurrect'    # Persist tmux sessions after computer restart

set -g @plugin 'tmux-plugins/tmux-continuum'    # Automatically saves sessions every 15 minutes

set -g @plugin 'barlevalon/tmux-nowplaying'

set -g @plugin 'nhdaly/tmux-better-mouse-mode'

set -g @plugin 'kenos1/tmux-cht-sh'

set -g @plugin "aless3/tmux-click-copy"
set -g @tcc_timeout 50
set -g @tcc_long_timeout 100

set -g @plugin 'tmux-plugins/tmux-yank'

set -g @resurrect-capture-pane-contents 'on'

run '~/.tmux/plugins/tpm/tpm'
