set -g default-shell /opt/homebrew/bin/fish

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

set -g mouse on

set -g base-index 1
setw -g pane-base-index 1

set -g renumber-windows on

set -g history-limit 1000000

set -g status-interval 3
set -g focus-events on

setw -g aggressive-resize on

set -g escape-time 10

set -g detach-on-destroy off

set -g set-clipboard on

set -gq allow-passthrough on

set -ga update-environment $TERM
set -ga update-environment $TERM_PROGRAM

#set -g status-left "#[fg=blue,bold]#S" #session name
#set -g status-left-length 60
#set -g status off
set -g status-position top
#set -g status-right ""
#set -g status-right-length 200
#set -g status-right-length 500
#set -g status-right '#{nowplaying} | %H:%M'
#set -g status-style 'bg=default'

unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "‚úì Config reloaded!"

# Split panes (maintain current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window (maintain current path)
bind c new-window -c "#{pane_current_path}"

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick homescreen access
bind C-h switch-client -t homescreen

# Kill pane/session with confirmation
bind q confirm-before -p "Kill pane #P? (y/n)" kill-pane
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ============================================
# Copy Mode (Vim bindings)
# ============================================

setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Don't exit copy mode on mouse selection
unbind -T copy-mode-vi MouseDragEnd1Pane

bind-key x kill-pane

bind-key "K" display-popup -E -w 40% "sesh connect \"$(
  sesh list -i | gum filter --limit 1 --placeholder 'Pick a sesh' --prompt='‚ö°'
)\""

bind-key "F" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' \
    --header '^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}' \
)\""

#bind-key "J" display-popup -E -w 55% -h 60% "~/.config/tmux/sesh-picker.sh"

set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'joshmedeski/tmux-fzf-url'

# =============================================================================
# TOKYO NIGHT FLASH GODDESS STORM THEME
# =============================================================================
set -g mode-style "fg=#9D7CD8,bg=#4B233E"

set -g message-style "fg=#9D7CD8,bg=#4B233E"
set -g message-command-style "fg=#9D7CD8,bg=#4B233E"

set -g pane-border-style "fg=#4B233E"
set -g pane-active-border-style "fg=#9D7CD8"

set -g status "on"
set -g status-justify "left"

set -g status-style "fg=#9D7CD8,bg=#202825"

set -g status-left-length "100"
set -g status-right-length "100"

set -g status-left-style NONE
set -g status-right-style NONE

set -g status-left "#[fg=#202825,bg=#9D7CD8,bold] #S #[fg=#9D7CD8,bg=#202825,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=#202825,bg=#202825,nobold,nounderscore,noitalics]#[fg=#9D7CD8,bg=#202825] #{prefix_highlight} #[fg=#4B233E,bg=#202825,nobold,nounderscore,noitalics]#[fg=#9D7CD8,bg=#4B233E] %Y-%m-%d  %I:%M %p #[fg=#9D7CD8,bg=#4B233E,nobold,nounderscore,noitalics]#[fg=#202825,bg=#9D7CD8,bold] #h "
if-shell '[ "$(tmux show-option -gqv "clock-mode-style")" == "24" ]' {
  set -g status-right "#[fg=#202825,bg=#202825,nobold,nounderscore,noitalics]#[fg=#9D7CD8,bg=#202825] #{prefix_highlight} #[fg=#4B233E,bg=#202825,nobold,nounderscore,noitalics]#[fg=#9D7CD8,bg=#4B233E] %Y-%m-%d  %H:%M #[fg=#9D7CD8,bg=#4B233E,nobold,nounderscore,noitalics]#[fg=#202825,bg=#9D7CD8,bold] #h "
}

setw -g window-status-activity-style "underscore,fg=#DED09F,bg=#202825"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=#DED09F,bg=#202825"
setw -g window-status-format "#[fg=#202825,bg=#202825,nobold,nounderscore,noitalics]#[default] #I  #W #F #[fg=#202825,bg=#202825,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=#202825,bg=#4B233E,nobold,nounderscore,noitalics]#[fg=#9D7CD8,bg=#4B233E,bold] #I  #W #F #[fg=#4B233E,bg=#202825,nobold,nounderscore,noitalics]"

# tmux-plugins/tmux-prefix-highlight support
set -g @prefix_highlight_output_prefix "#[fg=#D56920]#[bg=#202825]#[fg=#202825]#[bg=#D56920]"
set -g @prefix_highlight_output_suffix ""

# set -g @plugin 'dracula/tmux'
# set -g @dracula-show-left-icon "üêà‚Äç‚¨õ | #S | #W üêà‚Äç‚¨õ"
# set -g @dracula-left-icon-padding 1
# set -g @dracula-left-pad ' ¬∞ '
# set -g @dracula-right-pad ' ¬∞ '
#set -g @dracula-show-left-sep ÓÇ∏
# set -g @dracula-plugins "uptime time battery mac-player mpc playerctl spotify-tui spr"
# set -g @dracula-show-flags false
# set -g @dracula-refresh-rate 3
# set -g @dracula-border-contrast false
# set -g @dracula-show-empty-plugins false
# set -g @dracula-show-edge-icons false
# set -g @dracula-battery-label "‚ô•  "
# set -g @dracula-show-battery-status true
# set -g @dracula-mac-player-play-icon "‚ô™ "
# set -g @dracula-mac-player-pause-icon "‚ùö‚ùö "
# set -g @dracula-mac-player-length 250
# set -g @dracula-mac-player-remote true
# set -g @dracula-mac-player-remote-play-pause "P"
# set -g @dracula-mac-player-remote-back "R"
# set -g @dracula-mac-player-remote-next "N"
# set -g @dracula-show-timezone false
# set -g @dracula-time-format "%R"
#set -g @dracula-playerctl-format "‚ñ∫  {{ artist }} - {{ title }}"
#set -g @dracula-spotify-tui-format "%f %s %t - %a"
#set -g @dracula-spotify-tui-max-len 0
#set -g @dracula-spr-play-icon "‚ô™ "
#set -g @dracula-spr-pause-icon "‚ùö‚ùö "
#set -g @dracula-spr-remote true
#set -g @dracula-spr-remote-play-pause "P"
#set -g @dracula-spr-remote-back "R"
#set -g @dracula-spr-remote-next "N"

set -g @plugin 'jaclu/tmux-power-zoom'

set -g @plugin 'christoomey/vim-tmux-navigator' # Enable navigating between nvim and tmux

set -g @plugin 'tmux-plugins/tmux-resurrect'    # Persist tmux sessions after computer restart

set -g @plugin 'tmux-plugins/tmux-continuum'    # Automatically saves sessions every 15 minutes

set -g @plugin 'barlevalon/tmux-nowplaying'

set -g @plugin 'nhdaly/tmux-better-mouse-mode'

set -g @plugin 'kenos1/tmux-cht-sh'

set -g @plugin "aless3/tmux-click-copy"
set -g @tcc_timeout 50
set -g @tcc_long_timeout 100

set -g @plugin 'tmux-plugins/tmux-yank'

set -g @resurrect-capture-pane-contents 'on'

run '~/.tmux/plugins/tpm/tpm'
